---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Reports - PowerReview">
	<main>
		<div class="container">
			<div class="page-header">
				<h1>Security Assessment Reports</h1>
				<p>Access and manage your security assessment reports</p>
			</div>

			<!-- Report Filters -->
			<div class="filters">
				<div class="filter-group">
					<label>Date Range</label>
					<select id="dateFilter">
						<option value="all">All Time</option>
						<option value="today">Today</option>
						<option value="week">Last 7 Days</option>
						<option value="month">Last 30 Days</option>
					</select>
				</div>
				<div class="filter-group">
					<label>Report Type</label>
					<select id="typeFilter">
						<option value="all">All Types</option>
						<option value="executive">Executive</option>
						<option value="technical">Technical</option>
						<option value="compliance">Compliance</option>
					</select>
				</div>
				<div class="filter-group">
					<label>Status</label>
					<select id="statusFilter">
						<option value="all">All Status</option>
						<option value="completed">Completed</option>
						<option value="in-progress">In Progress</option>
						<option value="scheduled">Scheduled</option>
					</select>
				</div>
				<button class="btn btn-primary" onclick="window.location.href='/reports-enhanced'">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="12" y1="5" x2="12" y2="19"></line>
						<line x1="5" y1="12" x2="19" y2="12"></line>
					</svg>
					Enhanced Reports
				</button>
			</div>

			<!-- Reports List -->
			<div class="reports-grid">
				<!-- Executive Report -->
				<div class="report-card executive">
					<div class="report-header">
						<div class="report-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
								<circle cx="9" cy="7" r="4"></circle>
								<path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
								<path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
							</svg>
						</div>
						<div class="report-meta">
							<h3>Executive Security Report</h3>
							<p class="report-date">Generated: July 11, 2025</p>
						</div>
						<span class="report-badge completed">Completed</span>
					</div>
					<div class="report-content">
						<div class="report-stats">
							<div class="stat">
								<span class="stat-label">Risk Score</span>
								<span class="stat-value critical">78%</span>
							</div>
							<div class="stat">
								<span class="stat-label">Findings</span>
								<span class="stat-value">47</span>
							</div>
							<div class="stat">
								<span class="stat-label">Compliance</span>
								<span class="stat-value">45%</span>
							</div>
						</div>
						<p class="report-summary">
							Comprehensive executive analysis with Gold/Silver/Bronze recommendations, financial impact assessment, and evidence-based findings.
						</p>
					</div>
					<div class="report-actions">
						<button class="btn-action" onclick="viewReport('executive-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
								<circle cx="12" cy="12" r="3"></circle>
							</svg>
							View
						</button>
						<button class="btn-action" onclick="downloadReport('executive-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
								<polyline points="7 10 12 15 17 10"></polyline>
								<line x1="12" y1="15" x2="12" y2="3"></line>
							</svg>
							Download
						</button>
						<button class="btn-action" onclick="shareReport('executive-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<circle cx="18" cy="5" r="3"></circle>
								<circle cx="6" cy="12" r="3"></circle>
								<circle cx="18" cy="19" r="3"></circle>
								<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
								<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
							</svg>
							Share
						</button>
					</div>
				</div>

				<!-- Technical Report -->
				<div class="report-card technical">
					<div class="report-header">
						<div class="report-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<polyline points="16 18 22 12 16 6"></polyline>
								<polyline points="8 6 2 12 8 18"></polyline>
							</svg>
						</div>
						<div class="report-meta">
							<h3>Technical Assessment Report</h3>
							<p class="report-date">Generated: July 10, 2025</p>
						</div>
						<span class="report-badge completed">Completed</span>
					</div>
					<div class="report-content">
						<div class="report-stats">
							<div class="stat">
								<span class="stat-label">Vulnerabilities</span>
								<span class="stat-value">23</span>
							</div>
							<div class="stat">
								<span class="stat-label">Critical</span>
								<span class="stat-value critical">5</span>
							</div>
							<div class="stat">
								<span class="stat-label">Remediated</span>
								<span class="stat-value">12</span>
							</div>
						</div>
						<p class="report-summary">
							Detailed technical analysis with PowerShell remediation scripts, configuration recommendations, and implementation guides.
						</p>
					</div>
					<div class="report-actions">
						<button class="btn-action" onclick="viewReport('technical-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
								<circle cx="12" cy="12" r="3"></circle>
							</svg>
							View
						</button>
						<button class="btn-action" onclick="downloadReport('technical-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
								<polyline points="7 10 12 15 17 10"></polyline>
								<line x1="12" y1="15" x2="12" y2="3"></line>
							</svg>
							Download
						</button>
						<button class="btn-action" onclick="shareReport('technical-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<circle cx="18" cy="5" r="3"></circle>
								<circle cx="6" cy="12" r="3"></circle>
								<circle cx="18" cy="19" r="3"></circle>
								<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
								<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
							</svg>
							Share
						</button>
					</div>
				</div>

				<!-- Compliance Report -->
				<div class="report-card compliance">
					<div class="report-header">
						<div class="report-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M9 11l3 3L22 4"></path>
								<path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
							</svg>
						</div>
						<div class="report-meta">
							<h3>Compliance Assessment Report</h3>
							<p class="report-date">Generated: July 9, 2025</p>
						</div>
						<span class="report-badge completed">Completed</span>
					</div>
					<div class="report-content">
						<div class="report-stats">
							<div class="stat">
								<span class="stat-label">GDPR</span>
								<span class="stat-value">65%</span>
							</div>
							<div class="stat">
								<span class="stat-label">HIPAA</span>
								<span class="stat-value">72%</span>
							</div>
							<div class="stat">
								<span class="stat-label">SOC2</span>
								<span class="stat-value">58%</span>
							</div>
						</div>
						<p class="report-summary">
							Compliance mapping against major frameworks with gap analysis, remediation roadmap, and audit preparation guidance.
						</p>
					</div>
					<div class="report-actions">
						<button class="btn-action" onclick="viewReport('compliance-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
								<circle cx="12" cy="12" r="3"></circle>
							</svg>
							View
						</button>
						<button class="btn-action" onclick="downloadReport('compliance-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
								<polyline points="7 10 12 15 17 10"></polyline>
								<line x1="12" y1="15" x2="12" y2="3"></line>
							</svg>
							Download
						</button>
						<button class="btn-action" onclick="shareReport('compliance-latest')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<circle cx="18" cy="5" r="3"></circle>
								<circle cx="6" cy="12" r="3"></circle>
								<circle cx="18" cy="19" r="3"></circle>
								<line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
								<line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
							</svg>
							Share
						</button>
					</div>
				</div>

				<!-- In Progress Report -->
				<div class="report-card in-progress">
					<div class="report-header">
						<div class="report-icon">
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<circle cx="12" cy="12" r="10"></circle>
								<polyline points="12 6 12 12 16 14"></polyline>
							</svg>
						</div>
						<div class="report-meta">
							<h3>Azure Security Assessment</h3>
							<p class="report-date">Started: July 11, 2025</p>
						</div>
						<span class="report-badge in-progress">In Progress</span>
					</div>
					<div class="report-content">
						<div class="progress-bar">
							<div class="progress-fill" style="width: 65%"></div>
						</div>
						<p class="progress-text">65% Complete - Analyzing Azure AD configurations...</p>
						<p class="report-summary">
							Comprehensive Azure infrastructure security assessment including network security groups, key vaults, and resource compliance.
						</p>
					</div>
					<div class="report-actions">
						<button class="btn-action" onclick="viewProgress('azure-assessment')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
							</svg>
							Monitor
						</button>
						<button class="btn-action" onclick="cancelAssessment('azure-assessment')">
							<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<circle cx="12" cy="12" r="10"></circle>
								<line x1="15" y1="9" x2="9" y2="15"></line>
								<line x1="9" y1="9" x2="15" y2="15"></line>
							</svg>
							Cancel
						</button>
					</div>
				</div>
			</div>

			<!-- Scheduled Reports -->
			<section class="scheduled-section">
				<h2>Scheduled Reports</h2>
				<div class="scheduled-grid">
					<div class="scheduled-card">
						<div class="scheduled-icon">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
								<line x1="16" y1="2" x2="16" y2="6"></line>
								<line x1="8" y1="2" x2="8" y2="6"></line>
								<line x1="3" y1="10" x2="21" y2="10"></line>
							</svg>
						</div>
						<div class="scheduled-info">
							<h4>Weekly Security Report</h4>
							<p>Every Monday at 9:00 AM</p>
						</div>
						<button class="btn-edit" onclick="editSchedule('weekly-security')">Edit</button>
					</div>
					<div class="scheduled-card">
						<div class="scheduled-icon">
							<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
								<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
								<line x1="16" y1="2" x2="16" y2="6"></line>
								<line x1="8" y1="2" x2="8" y2="6"></line>
								<line x1="3" y1="10" x2="21" y2="10"></line>
							</svg>
						</div>
						<div class="scheduled-info">
							<h4>Monthly Compliance Check</h4>
							<p>First day of each month</p>
						</div>
						<button class="btn-edit" onclick="editSchedule('monthly-compliance')">Edit</button>
					</div>
				</div>
			</section>
		</div>
	</main>
</Layout>

<style>
	main {
		min-height: calc(100vh - 200px);
		background: var(--color-bg);
	}

	.container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 2rem;
	}

	.page-header {
		margin-bottom: 2rem;
	}

	.page-header h1 {
		font-size: 2.5rem;
		font-weight: 700;
		color: var(--color-dark);
		margin-bottom: 0.5rem;
	}

	.page-header p {
		font-size: 1.125rem;
		color: var(--color-gray);
	}

	.filters {
		display: flex;
		gap: 1rem;
		margin-bottom: 2rem;
		flex-wrap: wrap;
		align-items: flex-end;
	}

	.filter-group {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.filter-group label {
		font-size: 0.875rem;
		font-weight: 600;
		color: var(--color-dark);
	}

	.filter-group select {
		padding: 0.5rem 1rem;
		border: 1px solid var(--color-light-gray);
		border-radius: 6px;
		background: white;
		min-width: 150px;
		font-size: 0.875rem;
		color: var(--color-dark);
		cursor: pointer;
	}

	.btn {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 1rem;
		border-radius: 6px;
		font-weight: 600;
		text-decoration: none;
		transition: all 0.3s ease;
		border: none;
		cursor: pointer;
		font-size: 0.875rem;
	}

	.btn-primary {
		background: var(--color-primary);
		color: white;
		margin-left: auto;
	}

	.btn-primary:hover {
		background: var(--color-primary-dark);
		transform: translateY(-1px);
	}

	.reports-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
		gap: 1.5rem;
		margin-bottom: 3rem;
	}

	.report-card {
		background: white;
		border-radius: 12px;
		box-shadow: var(--shadow-md);
		overflow: hidden;
		transition: all 0.3s ease;
	}

	.report-card:hover {
		transform: translateY(-5px);
		box-shadow: var(--shadow-lg);
	}

	.report-header {
		display: flex;
		align-items: center;
		gap: 1rem;
		padding: 1.5rem;
		border-bottom: 1px solid var(--color-light-gray);
	}

	.report-icon {
		width: 48px;
		height: 48px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-radius: 12px;
		flex-shrink: 0;
	}

	.report-card.executive .report-icon {
		background: rgba(102, 126, 234, 0.1);
		color: var(--color-primary);
	}

	.report-card.technical .report-icon {
		background: rgba(251, 146, 60, 0.1);
		color: #fb923c;
	}

	.report-card.compliance .report-icon {
		background: rgba(34, 197, 94, 0.1);
		color: #22c55e;
	}

	.report-card.in-progress .report-icon {
		background: rgba(59, 130, 246, 0.1);
		color: #3b82f6;
	}

	.report-meta {
		flex: 1;
	}

	.report-meta h3 {
		font-size: 1.125rem;
		font-weight: 600;
		color: var(--color-dark);
		margin-bottom: 0.25rem;
	}

	.report-date {
		font-size: 0.875rem;
		color: var(--color-gray);
	}

	.report-badge {
		padding: 0.25rem 0.75rem;
		border-radius: 20px;
		font-size: 0.75rem;
		font-weight: 600;
		text-transform: uppercase;
	}

	.report-badge.completed {
		background: rgba(34, 197, 94, 0.1);
		color: #22c55e;
	}

	.report-badge.in-progress {
		background: rgba(59, 130, 246, 0.1);
		color: #3b82f6;
	}

	.report-content {
		padding: 1.5rem;
	}

	.report-stats {
		display: flex;
		gap: 2rem;
		margin-bottom: 1rem;
	}

	.stat {
		text-align: center;
	}

	.stat-label {
		display: block;
		font-size: 0.75rem;
		color: var(--color-gray);
		margin-bottom: 0.25rem;
	}

	.stat-value {
		display: block;
		font-size: 1.5rem;
		font-weight: 700;
		color: var(--color-dark);
	}

	.stat-value.critical {
		color: #ef4444;
	}

	.report-summary {
		font-size: 0.875rem;
		color: var(--color-gray);
		line-height: 1.6;
	}

	.progress-bar {
		width: 100%;
		height: 8px;
		background: var(--color-light-gray);
		border-radius: 4px;
		overflow: hidden;
		margin-bottom: 0.5rem;
	}

	.progress-fill {
		height: 100%;
		background: var(--color-primary);
		transition: width 0.3s ease;
	}

	.progress-text {
		font-size: 0.875rem;
		color: var(--color-primary);
		margin-bottom: 1rem;
	}

	.report-actions {
		display: flex;
		gap: 0.5rem;
		padding: 1rem 1.5rem;
		background: var(--color-bg);
		border-top: 1px solid var(--color-light-gray);
	}

	.btn-action {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 1rem;
		background: white;
		border: 1px solid var(--color-light-gray);
		border-radius: 6px;
		font-size: 0.875rem;
		color: var(--color-gray);
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.btn-action:hover {
		background: var(--color-primary);
		color: white;
		border-color: var(--color-primary);
	}

	.scheduled-section {
		margin-top: 3rem;
	}

	.scheduled-section h2 {
		font-size: 1.75rem;
		font-weight: 600;
		color: var(--color-dark);
		margin-bottom: 1.5rem;
	}

	.scheduled-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
		gap: 1rem;
	}

	.scheduled-card {
		display: flex;
		align-items: center;
		gap: 1rem;
		background: white;
		padding: 1.5rem;
		border-radius: 8px;
		box-shadow: var(--shadow-sm);
	}

	.scheduled-icon {
		width: 40px;
		height: 40px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: var(--color-bg);
		border-radius: 8px;
		color: var(--color-primary);
	}

	.scheduled-info {
		flex: 1;
	}

	.scheduled-info h4 {
		font-size: 1rem;
		font-weight: 600;
		color: var(--color-dark);
		margin-bottom: 0.25rem;
	}

	.scheduled-info p {
		font-size: 0.875rem;
		color: var(--color-gray);
	}

	.btn-edit {
		padding: 0.5rem 1rem;
		background: transparent;
		border: 1px solid var(--color-primary);
		color: var(--color-primary);
		border-radius: 6px;
		font-size: 0.875rem;
		cursor: pointer;
		transition: all 0.3s ease;
	}

	.btn-edit:hover {
		background: var(--color-primary);
		color: white;
	}

	@media (max-width: 768px) {
		.reports-grid {
			grid-template-columns: 1fr;
		}

		.filters {
			flex-direction: column;
			align-items: stretch;
		}

		.btn-primary {
			margin-left: 0;
			width: 100%;
			justify-content: center;
		}
	}
</style>

<script>
	// Check authentication
	document.addEventListener('DOMContentLoaded', () => {
		const token = localStorage.getItem('auth-token');
		if (!token) {
			window.location.href = '/login';
		}
	});

	function generateNewReport() {
		// Go directly to the assessment execution page to see scripts running
		window.location.href = '/assessment-execution';
	}

	function viewReport(reportId) {
		if (reportId === 'executive-latest') {
			window.location.href = '/executive-dashboard';
		} else {
			window.location.href = `/report-viewer?id=${reportId}`;
		}
	}

	function downloadReport(reportId) {
		// In production, this would trigger a download
		alert(`Downloading report: ${reportId}`);
	}

	function shareReport(reportId) {
		// In production, this would open a share dialog
		alert(`Share functionality coming soon for report: ${reportId}`);
	}

	function viewProgress(assessmentId) {
		window.location.href = `/execute?session=${assessmentId}`;
	}

	function cancelAssessment(assessmentId) {
		if (confirm('Are you sure you want to cancel this assessment?')) {
			alert(`Assessment ${assessmentId} cancelled`);
		}
	}

	function editSchedule(scheduleId) {
		alert(`Schedule editor coming soon for: ${scheduleId}`);
	}

	// Filter functionality
	document.getElementById('dateFilter')?.addEventListener('change', filterReports);
	document.getElementById('typeFilter')?.addEventListener('change', filterReports);
	document.getElementById('statusFilter')?.addEventListener('change', filterReports);

	function filterReports() {
		// In production, this would filter the reports
		console.log('Filtering reports...');
	}
</script>