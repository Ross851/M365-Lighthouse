---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Security Assessment Report - PowerReview">
  <!-- Load Chart.js and other dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <main>
    <!-- Report Header with Key Metrics -->
    <div class="report-header">
      <div class="header-content">
        <div class="org-info">
          <h1 id="reportTitle">Executive Security Assessment</h1>
          <div class="org-details">
            <span class="org-name"><i class="fas fa-building"></i> <span id="orgName">Contoso Corporation</span></span>
            <span class="report-date"><i class="fas fa-calendar"></i> <span id="reportDate">Generated: January 2025</span></span>
            <span class="report-id"><i class="fas fa-fingerprint"></i> Report ID: <span id="reportId">EXEC-2025-001</span></span>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn-action" onclick="window.print()">
            <i class="fas fa-file-pdf"></i> Export PDF
          </button>
          <button class="btn-action" onclick="downloadReport('excel')">
            <i class="fas fa-file-excel"></i> Export Excel
          </button>
          <button class="btn-action" onclick="shareReport()">
            <i class="fas fa-share-alt"></i> Share
          </button>
        </div>
      </div>
    </div>

    <!-- Executive Summary Dashboard -->
    <section class="executive-summary">
      <div class="summary-grid">
        <div class="metric-card critical">
          <div class="metric-header">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Risk Score</span>
          </div>
          <div class="metric-value" id="riskScore">78%</div>
          <div class="metric-trend">
            <i class="fas fa-arrow-up"></i> 5% from last assessment
          </div>
          <div class="metric-description">
            High risk due to 12 critical findings
          </div>
        </div>

        <div class="metric-card warning">
          <div class="metric-header">
            <i class="fas fa-shield-alt"></i>
            <span>Security Posture</span>
          </div>
          <div class="metric-value">Moderate</div>
          <div class="metric-trend">
            <i class="fas fa-arrow-right"></i> No change
          </div>
          <div class="metric-description">
            Needs immediate attention in 3 areas
          </div>
        </div>

        <div class="metric-card success">
          <div class="metric-header">
            <i class="fas fa-check-circle"></i>
            <span>Compliance</span>
          </div>
          <div class="metric-value" id="complianceScore">85%</div>
          <div class="metric-trend">
            <i class="fas fa-arrow-up"></i> 3% improvement
          </div>
          <div class="metric-description">
            Meeting most regulatory requirements
          </div>
        </div>

        <div class="metric-card info">
          <div class="metric-header">
            <i class="fas fa-clock"></i>
            <span>Time to Fix</span>
          </div>
          <div class="metric-value">45 days</div>
          <div class="metric-trend">
            <i class="fas fa-tasks"></i> 23 action items
          </div>
          <div class="metric-description">
            Estimated for critical issues
          </div>
        </div>
      </div>
    </section>

    <!-- Navigation Tabs -->
    <nav class="report-nav">
      <button class="nav-tab active" onclick="showSection('overview')">
        <i class="fas fa-chart-line"></i> Overview
      </button>
      <button class="nav-tab" onclick="showSection('findings')">
        <i class="fas fa-search"></i> Findings
      </button>
      <button class="nav-tab" onclick="showSection('recommendations')">
        <i class="fas fa-lightbulb"></i> Recommendations
      </button>
      <button class="nav-tab" onclick="showSection('pathway')">
        <i class="fas fa-road"></i> Success Pathway
      </button>
      <button class="nav-tab" onclick="showSection('evidence')">
        <i class="fas fa-file-alt"></i> Evidence
      </button>
      <button class="nav-tab" onclick="showSection('timeline')">
        <i class="fas fa-calendar-alt"></i> Action Plan
      </button>
    </nav>

    <!-- Overview Section -->
    <section id="overview" class="report-section active">
      <h2><i class="fas fa-chart-line"></i> Security Overview</h2>
      
      <div class="overview-grid">
        <div class="overview-chart">
          <h3>Risk Distribution</h3>
          <canvas id="riskChart"></canvas>
        </div>
        
        <div class="overview-summary">
          <h3>Executive Summary</h3>
          <p class="summary-text">
            Your Microsoft 365 environment shows <strong>significant security gaps</strong> that require immediate attention. 
            Our assessment identified <strong>12 critical</strong> and <strong>23 high-priority</strong> findings across your tenant.
          </p>
          
          <div class="key-insights">
            <h4>Key Insights:</h4>
            <ul>
              <li><i class="fas fa-exclamation-circle text-critical"></i> <strong>Multi-Factor Authentication</strong> is not enforced for 78% of users</li>
              <li><i class="fas fa-exclamation-circle text-critical"></i> <strong>Legacy authentication</strong> protocols are still enabled</li>
              <li><i class="fas fa-exclamation-circle text-warning"></i> <strong>External sharing</strong> is unrestricted in SharePoint</li>
              <li><i class="fas fa-exclamation-circle text-warning"></i> <strong>Conditional Access</strong> policies are insufficient</li>
            </ul>
          </div>
          
          <div class="impact-analysis">
            <h4>Business Impact:</h4>
            <div class="impact-grid">
              <div class="impact-item">
                <i class="fas fa-dollar-sign"></i>
                <strong>Financial Risk:</strong> $2.3M potential breach cost
              </div>
              <div class="impact-item">
                <i class="fas fa-gavel"></i>
                <strong>Compliance Risk:</strong> GDPR violations possible
              </div>
              <div class="impact-item">
                <i class="fas fa-users"></i>
                <strong>User Impact:</strong> 2,500 accounts at risk
              </div>
              <div class="impact-item">
                <i class="fas fa-clock"></i>
                <strong>Downtime Risk:</strong> 48-72 hours potential
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Service Health Matrix -->
      <div class="service-matrix">
        <h3>Service Security Status</h3>
        <div class="service-grid">
          <div class="service-card critical">
            <i class="fab fa-microsoft"></i>
            <h4>Azure AD</h4>
            <div class="service-score">45%</div>
            <ul class="service-issues">
              <li>MFA not enforced</li>
              <li>No PIM configured</li>
              <li>Weak password policy</li>
            </ul>
          </div>
          
          <div class="service-card warning">
            <i class="fas fa-envelope"></i>
            <h4>Exchange Online</h4>
            <div class="service-score">68%</div>
            <ul class="service-issues">
              <li>Legacy auth enabled</li>
              <li>No DKIM configured</li>
            </ul>
          </div>
          
          <div class="service-card moderate">
            <i class="fas fa-folder"></i>
            <h4>SharePoint</h4>
            <div class="service-score">72%</div>
            <ul class="service-issues">
              <li>External sharing open</li>
              <li>No DLP policies</li>
            </ul>
          </div>
          
          <div class="service-card good">
            <i class="fas fa-shield-alt"></i>
            <h4>Defender</h4>
            <div class="service-score">85%</div>
            <ul class="service-issues">
              <li>Safe attachments off</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Findings Section -->
    <section id="findings" class="report-section">
      <h2><i class="fas fa-search"></i> Detailed Security Findings</h2>
      
      <div class="findings-filters">
        <button class="filter-btn active" onclick="filterFindings('all')">All (35)</button>
        <button class="filter-btn" onclick="filterFindings('critical')">Critical (12)</button>
        <button class="filter-btn" onclick="filterFindings('high')">High (23)</button>
        <button class="filter-btn" onclick="filterFindings('medium')">Medium (45)</button>
        <button class="filter-btn" onclick="filterFindings('low')">Low (67)</button>
      </div>

      <div class="findings-list">
        <!-- Critical Finding Example -->
        <div class="finding-card critical" data-severity="critical">
          <div class="finding-header">
            <div class="finding-title">
              <span class="severity-badge critical">CRITICAL</span>
              <h3>Multi-Factor Authentication Not Enforced</h3>
            </div>
            <div class="finding-meta">
              <span><i class="fas fa-server"></i> Azure AD</span>
              <span><i class="fas fa-tag"></i> Identity & Access</span>
              <span><i class="fas fa-fingerprint"></i> AAD-001</span>
            </div>
          </div>
          
          <div class="finding-content">
            <div class="finding-description">
              <h4>Description</h4>
              <p>Multi-factor authentication is not enforced for 78% of user accounts, including 15 administrative accounts. This creates a critical security vulnerability where accounts can be compromised with just a password.</p>
            </div>
            
            <div class="finding-evidence">
              <h4>Evidence</h4>
              <div class="evidence-box">
                <pre><code>Get-MsolUser -All | Where {$_.StrongAuthenticationMethods.Count -eq 0} | Measure
Count: 1,950 users without MFA

Get-MsolRole -RoleName "*admin*" | Get-MsolRoleMember | Where {$_.StrongAuthenticationMethods.Count -eq 0}
Found: 15 admin accounts without MFA</code></pre>
              </div>
              <button class="btn-link" onclick="viewFullEvidence('AAD-001')">
                <i class="fas fa-external-link-alt"></i> View Full Evidence
              </button>
            </div>
            
            <div class="finding-impact">
              <h4>Business Impact</h4>
              <ul>
                <li><i class="fas fa-exclamation-triangle"></i> <strong>High risk</strong> of account compromise and data breach</li>
                <li><i class="fas fa-dollar-sign"></i> Average breach cost: <strong>$4.45M</strong> (IBM Security Report 2023)</li>
                <li><i class="fas fa-gavel"></i> <strong>Compliance violation</strong> for GDPR, HIPAA, SOX requirements</li>
                <li><i class="fas fa-user-times"></i> <strong>15 admin accounts</strong> could provide full tenant access if compromised</li>
              </ul>
            </div>
            
            <div class="finding-remediation">
              <h4>Remediation Steps</h4>
              <ol>
                <li>
                  <strong>Immediate Action (Today):</strong> Enable MFA for all admin accounts
                  <button class="btn-script" onclick="showScript('enable-mfa-admins')">
                    <i class="fas fa-code"></i> PowerShell Script
                  </button>
                </li>
                <li>
                  <strong>Phase 1 (Week 1):</strong> Enable MFA for all users with licenses
                  <button class="btn-guide" onclick="showGuide('mfa-rollout')">
                    <i class="fas fa-book"></i> Implementation Guide
                  </button>
                </li>
                <li>
                  <strong>Phase 2 (Week 2-3):</strong> Configure Conditional Access policies
                  <button class="btn-template" onclick="showTemplate('ca-policies')">
                    <i class="fas fa-file-code"></i> Policy Templates
                  </button>
                </li>
                <li>
                  <strong>Ongoing:</strong> Monitor MFA adoption and enforce compliance
                </li>
              </ol>
            </div>
            
            <div class="finding-references">
              <h4>References & Resources</h4>
              <ul>
                <li><a href="https://docs.microsoft.com/en-us/azure/active-directory/authentication/concept-mfa-howitworks" target="_blank">
                  <i class="fas fa-external-link-alt"></i> Microsoft MFA Documentation
                </a></li>
                <li><a href="https://www.cisa.gov/mfa" target="_blank">
                  <i class="fas fa-external-link-alt"></i> CISA MFA Best Practices
                </a></li>
                <li><a href="#" onclick="downloadResource('mfa-checklist')">
                  <i class="fas fa-download"></i> MFA Implementation Checklist
                </a></li>
              </ul>
            </div>
          </div>
        </div>

        <!-- High Finding Example -->
        <div class="finding-card high" data-severity="high">
          <div class="finding-header">
            <div class="finding-title">
              <span class="severity-badge high">HIGH</span>
              <h3>Legacy Authentication Protocols Enabled</h3>
            </div>
            <div class="finding-meta">
              <span><i class="fas fa-envelope"></i> Exchange Online</span>
              <span><i class="fas fa-lock"></i> Authentication</span>
              <span><i class="fas fa-fingerprint"></i> EXO-002</span>
            </div>
          </div>
          
          <div class="finding-content">
            <div class="finding-description">
              <h4>Description</h4>
              <p>Legacy authentication protocols (SMTP, IMAP, POP3) are enabled, allowing connections that bypass modern security controls including MFA and Conditional Access policies.</p>
            </div>
            
            <div class="finding-evidence">
              <h4>Evidence</h4>
              <div class="evidence-box">
                <pre><code>Get-CASMailbox -ResultSize Unlimited | Where {$_.SmtpClientAuthenticationDisabled -eq $false}
Result: 2,345 mailboxes with SMTP auth enabled

Azure AD Sign-in Logs show:
- 156 legacy auth attempts in last 7 days
- 23 successful legacy authentications
- 5 different countries of origin</code></pre>
              </div>
            </div>
            
            <div class="finding-remediation">
              <h4>Remediation Steps</h4>
              <ol>
                <li>Audit current legacy authentication usage</li>
                <li>Create Conditional Access policy to block legacy auth</li>
                <li>Migrate users to modern authentication methods</li>
                <li>Monitor and disable legacy protocols</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recommendations Section -->
    <section id="recommendations" class="report-section" style="display: none;">
      <h2><i class="fas fa-lightbulb"></i> Strategic Recommendations</h2>
      
      <div class="recommendations-overview">
        <p class="lead">Based on our assessment, we recommend a phased approach to remediation that prioritizes critical risks while building a sustainable security posture.</p>
      </div>

      <!-- Gold Tier Recommendations -->
      <div class="recommendation-tier gold">
        <div class="tier-header">
          <div class="tier-badge">
            <i class="fas fa-trophy"></i>
            <span>Gold Tier</span>
          </div>
          <div class="tier-timeline">Immediate Action (0-30 days)</div>
          <div class="tier-investment">$50,000 - $100,000</div>
        </div>
        
        <div class="tier-content">
          <h3>Critical Security Improvements</h3>
          <p>These recommendations address your most critical vulnerabilities and provide immediate risk reduction.</p>
          
          <div class="recommendation-list">
            <div class="recommendation-item">
              <div class="rec-header">
                <h4><i class="fas fa-shield-alt"></i> Implement Zero Trust Architecture</h4>
                <span class="rec-priority">Priority: Critical</span>
              </div>
              <p>Establish a Zero Trust security model starting with identity verification and device compliance.</p>
              <div class="rec-details">
                <div class="rec-benefits">
                  <h5>Benefits:</h5>
                  <ul>
                    <li>90% reduction in successful breaches</li>
                    <li>Compliance with modern security frameworks</li>
                    <li>Enhanced visibility and control</li>
                  </ul>
                </div>
                <div class="rec-actions">
                  <h5>Action Items:</h5>
                  <ul>
                    <li>Enable MFA for all users</li>
                    <li>Implement Conditional Access policies</li>
                    <li>Deploy Microsoft Defender for Office 365</li>
                  </ul>
                </div>
              </div>
              <div class="rec-resources">
                <button class="btn-primary" onclick="showImplementationPlan('zero-trust')">
                  <i class="fas fa-project-diagram"></i> View Implementation Plan
                </button>
                <button class="btn-secondary" onclick="calculateROI('zero-trust')">
                  <i class="fas fa-calculator"></i> Calculate ROI
                </button>
              </div>
            </div>

            <div class="recommendation-item">
              <div class="rec-header">
                <h4><i class="fas fa-user-shield"></i> Privileged Identity Management</h4>
                <span class="rec-priority">Priority: Critical</span>
              </div>
              <p>Implement just-in-time administration to minimize standing privileges.</p>
              <div class="rec-details">
                <div class="rec-benefits">
                  <h5>Benefits:</h5>
                  <ul>
                    <li>95% reduction in privileged account compromises</li>
                    <li>Complete audit trail for compliance</li>
                    <li>Automated approval workflows</li>
                  </ul>
                </div>
                <div class="rec-actions">
                  <h5>Action Items:</h5>
                  <ul>
                    <li>Enable Azure AD PIM</li>
                    <li>Configure eligible assignments</li>
                    <li>Set up approval workflows</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <div class="tier-summary">
            <div class="summary-metrics">
              <div class="metric">
                <i class="fas fa-shield-check"></i>
                <strong>Risk Reduction:</strong> 65%
              </div>
              <div class="metric">
                <i class="fas fa-clock"></i>
                <strong>Time to Implement:</strong> 30 days
              </div>
              <div class="metric">
                <i class="fas fa-chart-line"></i>
                <strong>Expected ROI:</strong> 300% in 12 months
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Silver Tier Recommendations -->
      <div class="recommendation-tier silver">
        <div class="tier-header">
          <div class="tier-badge">
            <i class="fas fa-medal"></i>
            <span>Silver Tier</span>
          </div>
          <div class="tier-timeline">Short-term (30-90 days)</div>
          <div class="tier-investment">$25,000 - $50,000</div>
        </div>
        
        <div class="tier-content">
          <h3>Advanced Protection Measures</h3>
          <p>Build on your security foundation with advanced threat protection and monitoring.</p>
          
          <div class="recommendation-list">
            <div class="recommendation-item">
              <div class="rec-header">
                <h4><i class="fas fa-radar"></i> Deploy Microsoft Sentinel</h4>
                <span class="rec-priority">Priority: High</span>
              </div>
              <p>Implement SIEM/SOAR capabilities for advanced threat detection and response.</p>
            </div>
            
            <div class="recommendation-item">
              <div class="rec-header">
                <h4><i class="fas fa-database"></i> Data Loss Prevention</h4>
                <span class="rec-priority">Priority: High</span>
              </div>
              <p>Protect sensitive data with comprehensive DLP policies across all services.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Bronze Tier Recommendations -->
      <div class="recommendation-tier bronze">
        <div class="tier-header">
          <div class="tier-badge">
            <i class="fas fa-award"></i>
            <span>Bronze Tier</span>
          </div>
          <div class="tier-timeline">Long-term (90+ days)</div>
          <div class="tier-investment">$10,000 - $25,000</div>
        </div>
        
        <div class="tier-content">
          <h3>Continuous Improvement</h3>
          <p>Establish ongoing security practices and user awareness programs.</p>
          
          <div class="recommendation-list">
            <div class="recommendation-item">
              <div class="rec-header">
                <h4><i class="fas fa-graduation-cap"></i> Security Awareness Training</h4>
                <span class="rec-priority">Priority: Medium</span>
              </div>
              <p>Implement comprehensive security training and phishing simulation programs.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Success Pathway Section -->
    <section id="pathway" class="report-section" style="display: none;">
      <h2><i class="fas fa-road"></i> Your Pathway to Security Excellence</h2>
      
      <div class="pathway-intro">
        <p class="lead-text">Based on your assessment results, we've created three implementation pathways tailored to different resource levels and business priorities. Each pathway follows Microsoft Security Best Practices and industry standards.</p>
      </div>

      <!-- Implementation Tiers -->
      <div class="implementation-tiers">
        <!-- Gold Tier - Comprehensive -->
        <div class="tier-card gold-tier">
          <div class="tier-header">
            <div class="tier-icon">
              <i class="fas fa-trophy"></i>
            </div>
            <h3>Gold Standard Implementation</h3>
            <span class="tier-badge">Recommended</span>
          </div>
          
          <div class="tier-metrics">
            <div class="metric">
              <span class="metric-label">Investment:</span>
              <span class="metric-value">$125,000 - $180,000</span>
            </div>
            <div class="metric">
              <span class="metric-label">Timeline:</span>
              <span class="metric-value">6-9 months</span>
            </div>
            <div class="metric">
              <span class="metric-label">Risk Reduction:</span>
              <span class="metric-value">95%</span>
            </div>
            <div class="metric">
              <span class="metric-label">ROI:</span>
              <span class="metric-value">285% in 2 years</span>
            </div>
          </div>

          <div class="tier-content">
            <h4>What You Get:</h4>
            <ul class="tier-features">
              <li><i class="fas fa-check-circle"></i> Zero Trust Architecture implementation</li>
              <li><i class="fas fa-check-circle"></i> Advanced threat protection with Microsoft Sentinel</li>
              <li><i class="fas fa-check-circle"></i> Complete identity governance with PIM</li>
              <li><i class="fas fa-check-circle"></i> Automated incident response playbooks</li>
              <li><i class="fas fa-check-circle"></i> 24/7 SOC monitoring integration</li>
              <li><i class="fas fa-check-circle"></i> Quarterly security assessments</li>
            </ul>

            <h4>Business Impact:</h4>
            <div class="impact-grid">
              <div class="impact-item positive">
                <i class="fas fa-shield-alt"></i>
                <span>Achieve compliance with all major frameworks (ISO 27001, SOC 2, NIST)</span>
              </div>
              <div class="impact-item positive">
                <i class="fas fa-chart-line"></i>
                <span>Reduce security incidents by 95%</span>
              </div>
              <div class="impact-item positive">
                <i class="fas fa-dollar-sign"></i>
                <span>Lower cyber insurance premiums by 40%</span>
              </div>
              <div class="impact-item positive">
                <i class="fas fa-users"></i>
                <span>Enable secure remote work for all employees</span>
              </div>
            </div>

            <h4>Best Practices Source:</h4>
            <div class="best-practices">
              <div class="practice-source">
                <i class="fab fa-microsoft"></i>
                <div>
                  <strong>Microsoft Security Best Practices</strong>
                  <p>Following the Microsoft Zero Trust deployment guide and M365 security baseline</p>
                  <a href="https://docs.microsoft.com/security/zero-trust/" target="_blank">View Documentation</a>
                </div>
              </div>
              <div class="practice-source">
                <i class="fas fa-shield-alt"></i>
                <div>
                  <strong>NIST Cybersecurity Framework</strong>
                  <p>Implementing all five core functions: Identify, Protect, Detect, Respond, Recover</p>
                  <a href="https://www.nist.gov/cyberframework" target="_blank">View Framework</a>
                </div>
              </div>
            </div>

            <div class="tier-actions">
              <button class="btn-action primary" onclick="downloadImplementationPlan('gold')">
                <i class="fas fa-download"></i> Download Gold Plan
              </button>
              <button class="btn-action secondary" onclick="scheduleConsultation('gold')">
                <i class="fas fa-calendar-check"></i> Schedule Consultation
              </button>
            </div>
          </div>
        </div>

        <!-- Silver Tier - Balanced -->
        <div class="tier-card silver-tier">
          <div class="tier-header">
            <div class="tier-icon">
              <i class="fas fa-medal"></i>
            </div>
            <h3>Silver Balanced Approach</h3>
            <span class="tier-badge">Most Popular</span>
          </div>
          
          <div class="tier-metrics">
            <div class="metric">
              <span class="metric-label">Investment:</span>
              <span class="metric-value">$60,000 - $90,000</span>
            </div>
            <div class="metric">
              <span class="metric-label">Timeline:</span>
              <span class="metric-value">3-6 months</span>
            </div>
            <div class="metric">
              <span class="metric-label">Risk Reduction:</span>
              <span class="metric-value">80%</span>
            </div>
            <div class="metric">
              <span class="metric-label">ROI:</span>
              <span class="metric-value">220% in 2 years</span>
            </div>
          </div>

          <div class="tier-content">
            <h4>What You Get:</h4>
            <ul class="tier-features">
              <li><i class="fas fa-check-circle"></i> Conditional Access policies for all users</li>
              <li><i class="fas fa-check-circle"></i> Microsoft Defender for Office 365</li>
              <li><i class="fas fa-check-circle"></i> Cloud App Security implementation</li>
              <li><i class="fas fa-check-circle"></i> Automated compliance reporting</li>
              <li><i class="fas fa-check-circle"></i> Monthly security reviews</li>
              <li><i class="fas fa-check-circle"></i> Incident response procedures</li>
            </ul>

            <h4>Business Impact:</h4>
            <div class="impact-grid">
              <div class="impact-item positive">
                <i class="fas fa-lock"></i>
                <span>Protect against 80% of common attacks</span>
              </div>
              <div class="impact-item positive">
                <i class="fas fa-clipboard-check"></i>
                <span>Meet regulatory compliance requirements</span>
              </div>
              <div class="impact-item warning">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Manual intervention needed for advanced threats</span>
              </div>
              <div class="impact-item positive">
                <i class="fas fa-business-time"></i>
                <span>Reduce IT security workload by 60%</span>
              </div>
            </div>

            <h4>Decision Criteria:</h4>
            <div class="decision-points">
              <div class="decision-item">
                <i class="fas fa-check"></i>
                <strong>Choose Silver if:</strong>
                <ul>
                  <li>Budget constraints limit initial investment</li>
                  <li>You need quick wins to show ROI</li>
                  <li>Your team can handle some manual processes</li>
                  <li>You're in a medium-risk industry</li>
                </ul>
              </div>
            </div>

            <div class="tier-actions">
              <button class="btn-action primary" onclick="downloadImplementationPlan('silver')">
                <i class="fas fa-download"></i> Download Silver Plan
              </button>
              <button class="btn-action secondary" onclick="compareWithGold()">
                <i class="fas fa-balance-scale"></i> Compare with Gold
              </button>
            </div>
          </div>
        </div>

        <!-- Bronze Tier - Essential -->
        <div class="tier-card bronze-tier">
          <div class="tier-header">
            <div class="tier-icon">
              <i class="fas fa-shield-alt"></i>
            </div>
            <h3>Bronze Essential Protection</h3>
            <span class="tier-badge">Budget-Friendly</span>
          </div>
          
          <div class="tier-metrics">
            <div class="metric">
              <span class="metric-label">Investment:</span>
              <span class="metric-value">$25,000 - $40,000</span>
            </div>
            <div class="metric">
              <span class="metric-label">Timeline:</span>
              <span class="metric-value">1-3 months</span>
            </div>
            <div class="metric">
              <span class="metric-label">Risk Reduction:</span>
              <span class="metric-value">60%</span>
            </div>
            <div class="metric">
              <span class="metric-label">ROI:</span>
              <span class="metric-value">150% in 2 years</span>
            </div>
          </div>

          <div class="tier-content">
            <h4>What You Get:</h4>
            <ul class="tier-features">
              <li><i class="fas fa-check-circle"></i> MFA for all users</li>
              <li><i class="fas fa-check-circle"></i> Basic conditional access policies</li>
              <li><i class="fas fa-check-circle"></i> Security defaults enabled</li>
              <li><i class="fas fa-check-circle"></i> Basic DLP policies</li>
              <li><i class="fas fa-check-circle"></i> Quarterly security check-ins</li>
            </ul>

            <h4>Business Impact:</h4>
            <div class="impact-grid">
              <div class="impact-item positive">
                <i class="fas fa-user-shield"></i>
                <span>Stop 60% of credential attacks</span>
              </div>
              <div class="impact-item warning">
                <i class="fas fa-clock"></i>
                <span>Limited automation - higher operational overhead</span>
              </div>
              <div class="impact-item negative">
                <i class="fas fa-times-circle"></i>
                <span>Gaps in advanced threat protection</span>
              </div>
              <div class="impact-item positive">
                <i class="fas fa-piggy-bank"></i>
                <span>Minimal upfront investment</span>
              </div>
            </div>

            <h4>Important Considerations:</h4>
            <div class="warning-box">
              <i class="fas fa-exclamation-triangle"></i>
              <div>
                <strong>Risk Acknowledgment:</strong>
                <p>Bronze tier provides essential protection but leaves gaps that sophisticated attackers can exploit. We recommend upgrading to Silver within 12 months.</p>
              </div>
            </div>

            <div class="tier-actions">
              <button class="btn-action primary" onclick="downloadImplementationPlan('bronze')">
                <i class="fas fa-download"></i> Download Bronze Plan
              </button>
              <button class="btn-action warning" onclick="showUpgradePath()">
                <i class="fas fa-arrow-up"></i> View Upgrade Path
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Decision Matrix -->
      <div class="decision-matrix">
        <h3>Which Tier is Right for You?</h3>
        <div class="matrix-content">
          <div class="matrix-factors">
            <div class="factor-card">
              <h4><i class="fas fa-industry"></i> Industry Risk Level</h4>
              <ul>
                <li><strong>High Risk</strong> (Finance, Healthcare, Government): <span class="gold">Gold</span></li>
                <li><strong>Medium Risk</strong> (Retail, Manufacturing): <span class="silver">Silver</span></li>
                <li><strong>Low Risk</strong> (Small Business, Non-profit): <span class="bronze">Bronze</span></li>
              </ul>
            </div>
            <div class="factor-card">
              <h4><i class="fas fa-users"></i> Organization Size</h4>
              <ul>
                <li><strong>Enterprise</strong> (1000+ users): <span class="gold">Gold</span></li>
                <li><strong>Mid-Market</strong> (100-999 users): <span class="silver">Silver</span></li>
                <li><strong>Small Business</strong> (&lt;100 users): <span class="bronze">Bronze</span></li>
              </ul>
            </div>
            <div class="factor-card">
              <h4><i class="fas fa-balance-scale"></i> Compliance Requirements</h4>
              <ul>
                <li><strong>Strict</strong> (HIPAA, PCI-DSS, SOX): <span class="gold">Gold</span></li>
                <li><strong>Moderate</strong> (GDPR, CCPA): <span class="silver">Silver</span></li>
                <li><strong>Basic</strong> (Industry standards): <span class="bronze">Bronze</span></li>
              </ul>
            </div>
            <div class="factor-card">
              <h4><i class="fas fa-dollar-sign"></i> Security Budget</h4>
              <ul>
                <li><strong>>2%</strong> of IT budget: <span class="gold">Gold</span></li>
                <li><strong>1-2%</strong> of IT budget: <span class="silver">Silver</span></li>
                <li><strong>&lt;1%</strong> of IT budget: <span class="bronze">Bronze</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- ROI Calculator -->
      <div class="roi-calculator">
        <h3>Calculate Your Security ROI</h3>
        <div class="calculator-content">
          <div class="roi-inputs">
            <div class="input-group">
              <label>Average cost of a security breach:</label>
              <input type="text" id="breach-cost" value="$280,000" readonly>
            </div>
            <div class="input-group">
              <label>Current breach probability:</label>
              <input type="text" id="breach-prob" value="68%" readonly>
            </div>
            <div class="input-group">
              <label>Select implementation tier:</label>
              <select id="tier-select" onchange="calculateROI(this.value)">
                <option value="gold">Gold - 95% Risk Reduction</option>
                <option value="silver" selected>Silver - 80% Risk Reduction</option>
                <option value="bronze">Bronze - 60% Risk Reduction</option>
              </select>
            </div>
          </div>
          <div class="roi-results">
            <div class="roi-metric">
              <span class="label">Risk-Adjusted Savings:</span>
              <span class="value" id="roi-savings">$152,320</span>
            </div>
            <div class="roi-metric">
              <span class="label">Implementation Cost:</span>
              <span class="value" id="roi-cost">$75,000</span>
            </div>
            <div class="roi-metric highlight">
              <span class="label">2-Year ROI:</span>
              <span class="value" id="roi-percentage">220%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Next Steps -->
      <div class="next-steps">
        <h3>Ready to Get Started?</h3>
        <div class="steps-content">
          <p>Our security experts are ready to help you implement your chosen pathway. Schedule a consultation to discuss your specific needs and create a customized implementation plan.</p>
          <div class="steps-actions">
            <button class="btn-action large primary" onclick="scheduleConsultation()">
              <i class="fas fa-calendar-check"></i> Schedule Expert Consultation
            </button>
            <button class="btn-action large secondary" onclick="requestProposal()">
              <i class="fas fa-file-invoice"></i> Request Detailed Proposal
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Evidence Section -->
    <section id="evidence" class="report-section">
      <h2><i class="fas fa-file-alt"></i> Supporting Evidence</h2>
      
      <div class="evidence-grid">
        <div class="evidence-card">
          <div class="evidence-header">
            <i class="fas fa-terminal"></i>
            <h3>PowerShell Scripts Run</h3>
          </div>
          <div class="evidence-list">
            <div class="evidence-item">
              <span class="evidence-name">Get-MsolUser Analysis</span>
              <span class="evidence-time">2025-01-12 14:30:22</span>
              <button class="btn-view" onclick="viewEvidence('ps-001')">View Output</button>
            </div>
            <div class="evidence-item">
              <span class="evidence-name">Get-AzureADDirectoryRole</span>
              <span class="evidence-time">2025-01-12 14:31:45</span>
              <button class="btn-view" onclick="viewEvidence('ps-002')">View Output</button>
            </div>
          </div>
        </div>
        
        <div class="evidence-card">
          <div class="evidence-header">
            <i class="fas fa-camera"></i>
            <h3>Screenshots</h3>
          </div>
          <div class="evidence-gallery">
            <div class="screenshot-thumb" onclick="viewScreenshot('ss-001')">
              <img src="/api/placeholder/150/100" alt="Azure AD Config">
              <span>Azure AD Configuration</span>
            </div>
            <div class="screenshot-thumb" onclick="viewScreenshot('ss-002')">
              <img src="/api/placeholder/150/100" alt="CA Policies">
              <span>Conditional Access Policies</span>
            </div>
          </div>
        </div>
        
        <div class="evidence-card">
          <div class="evidence-header">
            <i class="fas fa-file-csv"></i>
            <h3>Exported Data</h3>
          </div>
          <div class="evidence-list">
            <div class="evidence-item">
              <span class="evidence-name">User_MFA_Status.csv</span>
              <span class="evidence-size">2.3 MB</span>
              <button class="btn-download" onclick="downloadEvidence('csv-001')">
                <i class="fas fa-download"></i> Download
              </button>
            </div>
            <div class="evidence-item">
              <span class="evidence-name">Legacy_Auth_Report.xlsx</span>
              <span class="evidence-size">1.8 MB</span>
              <button class="btn-download" onclick="downloadEvidence('xlsx-001')">
                <i class="fas fa-download"></i> Download
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Action Plan Timeline -->
    <section id="timeline" class="report-section">
      <h2><i class="fas fa-calendar-alt"></i> Implementation Timeline</h2>
      
      <div class="timeline-container">
        <div class="timeline-header">
          <p>Your customized 90-day security improvement roadmap</p>
        </div>
        
        <div class="timeline">
          <!-- Week 1-2 -->
          <div class="timeline-item">
            <div class="timeline-marker critical"></div>
            <div class="timeline-content">
              <h3>Weeks 1-2: Critical Controls</h3>
              <p>Focus on immediate risk reduction</p>
              <ul>
                <li>Enable MFA for all admin accounts</li>
                <li>Block legacy authentication</li>
                <li>Configure security defaults</li>
                <li>Enable audit logging</li>
              </ul>
              <div class="timeline-meta">
                <span><i class="fas fa-users"></i> IT Security Team</span>
                <span><i class="fas fa-clock"></i> 40 hours estimated</span>
              </div>
            </div>
          </div>
          
          <!-- Week 3-4 -->
          <div class="timeline-item">
            <div class="timeline-marker high"></div>
            <div class="timeline-content">
              <h3>Weeks 3-4: Identity Protection</h3>
              <p>Strengthen identity and access management</p>
              <ul>
                <li>Deploy Conditional Access policies</li>
                <li>Configure PIM for admin roles</li>
                <li>Implement risk-based policies</li>
              </ul>
              <div class="timeline-meta">
                <span><i class="fas fa-users"></i> IT Security + Identity Team</span>
                <span><i class="fas fa-clock"></i> 60 hours estimated</span>
              </div>
            </div>
          </div>
          
          <!-- Month 2 -->
          <div class="timeline-item">
            <div class="timeline-marker medium"></div>
            <div class="timeline-content">
              <h3>Month 2: Advanced Protection</h3>
              <p>Deploy advanced security features</p>
              <ul>
                <li>Configure Microsoft Defender</li>
                <li>Implement DLP policies</li>
                <li>Deploy Microsoft Sentinel</li>
              </ul>
            </div>
          </div>
          
          <!-- Month 3 -->
          <div class="timeline-item">
            <div class="timeline-marker low"></div>
            <div class="timeline-content">
              <h3>Month 3: Optimization & Training</h3>
              <p>Fine-tune and educate</p>
              <ul>
                <li>User security training</li>
                <li>Phishing simulations</li>
                <li>Policy optimization</li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="timeline-summary">
          <h3>Project Summary</h3>
          <div class="summary-grid">
            <div class="summary-item">
              <i class="fas fa-tasks"></i>
              <strong>Total Tasks:</strong> 47
            </div>
            <div class="summary-item">
              <i class="fas fa-clock"></i>
              <strong>Total Hours:</strong> 320
            </div>
            <div class="summary-item">
              <i class="fas fa-users"></i>
              <strong>Resources Needed:</strong> 4-6 people
            </div>
            <div class="summary-item">
              <i class="fas fa-dollar-sign"></i>
              <strong>Estimated Cost:</strong> $85,000
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Reset and Base Styles */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  main {
    background: #f8fafc;
    min-height: 100vh;
  }

  /* Report Header */
  .report-header {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    color: white;
    padding: 2rem 0;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  .header-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
  }

  .org-info h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    font-weight: 700;
  }

  .org-details {
    display: flex;
    gap: 2rem;
    font-size: 1rem;
    opacity: 0.9;
  }

  .org-details span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .header-actions {
    display: flex;
    gap: 1rem;
  }

  .btn-action {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    font-size: 0.95rem;
  }

  .btn-action:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
  }

  /* Executive Summary */
  .executive-summary {
    max-width: 1400px;
    margin: -3rem auto 2rem;
    padding: 0 2rem;
    position: relative;
    z-index: 10;
  }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .metric-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
    border: 1px solid transparent;
  }

  .metric-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
  }

  .metric-card.critical {
    border-color: #fee2e2;
    background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%);
  }

  .metric-card.warning {
    border-color: #fef3c7;
    background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%);
  }

  .metric-card.success {
    border-color: #d1fae5;
    background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
  }

  .metric-card.info {
    border-color: #dbeafe;
    background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
  }

  .metric-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    color: #64748b;
    font-size: 0.95rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .metric-value {
    font-size: 3rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 0.5rem;
  }

  .critical .metric-value { color: #dc2626; }
  .warning .metric-value { color: #f59e0b; }
  .success .metric-value { color: #10b981; }
  .info .metric-value { color: #3b82f6; }

  .metric-trend {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #64748b;
    margin-bottom: 1rem;
  }

  .metric-description {
    font-size: 0.95rem;
    color: #475569;
    line-height: 1.4;
  }

  /* Navigation Tabs */
  .report-nav {
    background: white;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .report-nav {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    gap: 0;
  }

  .nav-tab {
    background: none;
    border: none;
    padding: 1.25rem 2rem;
    font-size: 1rem;
    font-weight: 500;
    color: #64748b;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    position: relative;
    transition: all 0.3s ease;
  }

  .nav-tab:hover {
    color: #1e293b;
    background: #f8fafc;
  }

  .nav-tab.active {
    color: #6366f1;
    font-weight: 600;
  }

  .nav-tab.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: #6366f1;
  }

  /* Report Sections */
  .report-section {
    max-width: 1400px;
    margin: 0 auto;
    padding: 3rem 2rem;
    display: none;
  }

  .report-section.active {
    display: block;
  }

  .report-section h2 {
    font-size: 2rem;
    margin-bottom: 2rem;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  /* Overview Section */
  .overview-grid {
    display: grid;
    grid-template-columns: 1fr 1.5fr;
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .overview-chart {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .overview-summary {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .overview-summary h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: #1e293b;
  }

  .summary-text {
    font-size: 1.1rem;
    line-height: 1.8;
    color: #475569;
    margin-bottom: 2rem;
  }

  .key-insights {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
  }

  .key-insights h4 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    color: #1e293b;
  }

  .key-insights ul {
    list-style: none;
  }

  .key-insights li {
    padding: 0.5rem 0;
    display: flex;
    align-items: start;
    gap: 0.75rem;
  }

  .text-critical { color: #dc2626; }
  .text-warning { color: #f59e0b; }

  .impact-analysis {
    background: #fef2f2;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #fee2e2;
  }

  .impact-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-top: 1rem;
  }

  .impact-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.95rem;
  }

  /* Service Matrix */
  .service-matrix {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .service-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .service-card {
    padding: 1.5rem;
    border-radius: 8px;
    border: 2px solid;
    text-align: center;
  }

  .service-card.critical {
    background: #fef2f2;
    border-color: #dc2626;
  }

  .service-card.warning {
    background: #fffbeb;
    border-color: #f59e0b;
  }

  .service-card.moderate {
    background: #fefce8;
    border-color: #facc15;
  }

  .service-card.good {
    background: #f0fdf4;
    border-color: #10b981;
  }

  .service-card i {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
  }

  .service-card h4 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
  }

  .service-score {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }

  .service-issues {
    list-style: none;
    text-align: left;
    font-size: 0.9rem;
  }

  .service-issues li {
    padding: 0.25rem 0;
  }

  /* Findings Section */
  .findings-filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    background: white;
    border: 2px solid #e5e7eb;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .filter-btn:hover {
    border-color: #6366f1;
    color: #6366f1;
  }

  .filter-btn.active {
    background: #6366f1;
    color: white;
    border-color: #6366f1;
  }

  .findings-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .finding-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
  }

  .finding-card:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  }

  .finding-card.critical {
    border-left: 6px solid #dc2626;
  }

  .finding-card.high {
    border-left: 6px solid #f59e0b;
  }

  .finding-header {
    padding: 1.5rem;
    background: #f8fafc;
    border-bottom: 1px solid #e5e7eb;
  }

  .finding-title {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
  }

  .severity-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .severity-badge.critical {
    background: #dc2626;
    color: white;
  }

  .severity-badge.high {
    background: #f59e0b;
    color: white;
  }

  .finding-meta {
    display: flex;
    gap: 1.5rem;
    font-size: 0.875rem;
    color: #64748b;
  }

  .finding-meta span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .finding-content {
    padding: 1.5rem;
  }

  .finding-content > div {
    margin-bottom: 2rem;
  }

  .finding-content h4 {
    font-size: 1.1rem;
    margin-bottom: 0.75rem;
    color: #1e293b;
  }

  .evidence-box {
    background: #1e293b;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1rem 0;
  }

  .evidence-box pre {
    margin: 0;
    font-size: 0.875rem;
    line-height: 1.6;
  }

  .btn-link {
    background: none;
    border: none;
    color: #6366f1;
    cursor: pointer;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0;
    text-decoration: underline;
  }

  .btn-script, .btn-guide, .btn-template {
    background: #eff6ff;
    border: 1px solid #3b82f6;
    color: #3b82f6;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-left: 1rem;
    transition: all 0.3s ease;
  }

  .btn-script:hover, .btn-guide:hover, .btn-template:hover {
    background: #3b82f6;
    color: white;
  }

  .finding-remediation ol {
    padding-left: 1.5rem;
  }

  .finding-remediation li {
    margin-bottom: 1rem;
    line-height: 1.6;
  }

  .finding-references ul {
    list-style: none;
  }

  .finding-references a {
    color: #6366f1;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0;
  }

  .finding-references a:hover {
    text-decoration: underline;
  }

  /* Recommendations Section */
  .recommendations-overview {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .lead {
    font-size: 1.25rem;
    line-height: 1.8;
    color: #475569;
  }

  .recommendation-tier {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .tier-header {
    padding: 1.5rem 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: white;
  }

  .recommendation-tier.gold .tier-header {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  }

  .recommendation-tier.silver .tier-header {
    background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
  }

  .recommendation-tier.bronze .tier-header {
    background: linear-gradient(135deg, #92400e 0%, #78350f 100%);
  }

  .tier-badge {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 700;
  }

  .tier-content {
    padding: 2rem;
  }

  .recommendation-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .recommendation-item {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
  }

  .rec-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .rec-priority {
    background: #fee2e2;
    color: #dc2626;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .rec-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin: 1.5rem 0;
  }

  .rec-benefits h5, .rec-actions h5 {
    font-size: 1rem;
    margin-bottom: 0.5rem;
    color: #1e293b;
  }

  .rec-resources {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .btn-primary, .btn-secondary {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
  }

  .btn-primary {
    background: #6366f1;
    color: white;
  }

  .btn-primary:hover {
    background: #4f46e5;
    transform: translateY(-2px);
  }

  .btn-secondary {
    background: white;
    color: #6366f1;
    border: 2px solid #6366f1;
  }

  .btn-secondary:hover {
    background: #6366f1;
    color: white;
  }

  .tier-summary {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e5e7eb;
  }

  .summary-metrics {
    display: flex;
    justify-content: space-around;
    gap: 2rem;
  }

  .summary-metrics .metric {
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  /* Evidence Section */
  .evidence-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .evidence-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .evidence-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .evidence-header i {
    font-size: 1.5rem;
    color: #6366f1;
  }

  .evidence-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .evidence-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 8px;
  }

  .evidence-name {
    font-weight: 500;
    color: #1e293b;
  }

  .evidence-time, .evidence-size {
    font-size: 0.875rem;
    color: #64748b;
  }

  .btn-view, .btn-download {
    background: #eff6ff;
    border: 1px solid #3b82f6;
    color: #3b82f6;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.3s ease;
  }

  .btn-view:hover, .btn-download:hover {
    background: #3b82f6;
    color: white;
  }

  .evidence-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
  }

  .screenshot-thumb {
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
  }

  .screenshot-thumb:hover {
    transform: scale(1.05);
  }

  .screenshot-thumb img {
    width: 100%;
    border-radius: 8px;
    margin-bottom: 0.5rem;
  }

  .screenshot-thumb span {
    font-size: 0.875rem;
    color: #64748b;
  }

  /* Timeline Section */
  .timeline-container {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .timeline {
    position: relative;
    padding: 2rem 0;
  }

  .timeline::before {
    content: '';
    position: absolute;
    left: 2rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #e5e7eb;
  }

  .timeline-item {
    position: relative;
    padding-left: 4rem;
    margin-bottom: 3rem;
  }

  .timeline-marker {
    position: absolute;
    left: 1.25rem;
    top: 0;
    width: 1.5rem;
    height: 1.5rem;
    border-radius: 50%;
    border: 3px solid white;
    box-shadow: 0 0 0 2px #e5e7eb;
  }

  .timeline-marker.critical { background: #dc2626; }
  .timeline-marker.high { background: #f59e0b; }
  .timeline-marker.medium { background: #facc15; }
  .timeline-marker.low { background: #10b981; }

  .timeline-content {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
  }

  .timeline-content h3 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
    color: #1e293b;
  }

  .timeline-content ul {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }

  .timeline-meta {
    display: flex;
    gap: 1.5rem;
    margin-top: 1rem;
    font-size: 0.875rem;
    color: #64748b;
  }

  .timeline-summary {
    margin-top: 3rem;
    padding: 2rem;
    background: #f8fafc;
    border-radius: 8px;
  }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .summary-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  /* Animations */
  @keyframes slideIn {
    from {
      transform: translateX(100px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* Print Styles */
  @media print {
    .header-actions,
    .report-nav,
    .btn-action,
    .btn-script,
    .btn-guide,
    .btn-template,
    .btn-view,
    .btn-download,
    .filters-filters {
      display: none !important;
    }
    
    .report-section {
      display: block !important;
      page-break-before: always;
    }
    
    .finding-card,
    .recommendation-tier {
      page-break-inside: avoid;
    }
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .overview-grid {
      grid-template-columns: 1fr;
    }
    
    .header-content {
      flex-direction: column;
      text-align: center;
    }
    
    .org-details {
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .summary-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .summary-grid {
      grid-template-columns: 1fr;
    }
    
    .nav-tab {
      padding: 1rem;
      font-size: 0.9rem;
    }
    
    .nav-tab span {
      display: none;
    }
    
    .tier-header {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }
    
    .rec-details {
      grid-template-columns: 1fr;
    }
  }

  /* Success Pathway Styles */
  .pathway-intro {
    margin-bottom: 3rem;
    text-align: center;
  }

  .lead-text {
    font-size: 1.25rem;
    color: #475569;
    line-height: 1.8;
    max-width: 800px;
    margin: 0 auto;
  }

  .implementation-tiers {
    display: grid;
    gap: 2rem;
    margin-bottom: 4rem;
  }

  .tier-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .tier-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
  }

  .tier-card.gold-tier {
    border: 2px solid #fbbf24;
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
  }

  .tier-card.silver-tier {
    border: 2px solid #9ca3af;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
  }

  .tier-card.bronze-tier {
    border: 2px solid #d97706;
    background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
  }

  .tier-header {
    padding: 2rem;
    background: white;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .tier-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
  }

  .gold-tier .tier-icon {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    color: white;
  }

  .silver-tier .tier-icon {
    background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
    color: white;
  }

  .bronze-tier .tier-icon {
    background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
    color: white;
  }

  .tier-header h3 {
    flex: 1;
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
  }

  .tier-badge {
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 600;
    background: rgba(0, 0, 0, 0.05);
  }

  .tier-metrics {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: #e5e7eb;
    margin: 0;
  }

  .tier-metrics .metric {
    background: white;
    padding: 1.5rem;
    text-align: center;
  }

  .metric-label {
    display: block;
    font-size: 0.875rem;
    color: #64748b;
    margin-bottom: 0.5rem;
  }

  .metric-value {
    display: block;
    font-size: 1.25rem;
    font-weight: 700;
    color: #1e293b;
  }

  .tier-content {
    padding: 2rem;
  }

  .tier-content h4 {
    margin: 0 0 1rem;
    color: #1e293b;
    font-size: 1.125rem;
  }

  .tier-features {
    list-style: none;
    padding: 0;
    margin: 0 0 2rem;
  }

  .tier-features li {
    padding: 0.75rem 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border-bottom: 1px solid #f1f5f9;
  }

  .tier-features li:last-child {
    border-bottom: none;
  }

  .tier-features i {
    color: #10b981;
    font-size: 1.125rem;
  }

  .impact-grid {
    display: grid;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .impact-item {
    padding: 1rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 0.875rem;
  }

  .impact-item.positive {
    background: #d1fae5;
    color: #065f46;
  }

  .impact-item.warning {
    background: #fef3c7;
    color: #92400e;
  }

  .impact-item.negative {
    background: #fee2e2;
    color: #991b1b;
  }

  .impact-item i {
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .best-practices {
    display: grid;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .practice-source {
    padding: 1rem;
    background: #f8fafc;
    border-radius: 8px;
    display: flex;
    align-items: flex-start;
    gap: 1rem;
  }

  .practice-source i {
    font-size: 2rem;
    color: #0078d4;
  }

  .practice-source strong {
    display: block;
    margin-bottom: 0.25rem;
  }

  .practice-source p {
    font-size: 0.875rem;
    color: #64748b;
    margin: 0 0 0.5rem;
  }

  .practice-source a {
    font-size: 0.875rem;
    color: #2563eb;
    text-decoration: none;
  }

  .tier-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
  }

  .btn-action {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: none;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s ease;
  }

  .btn-action.primary {
    background: #2563eb;
    color: white;
  }

  .btn-action.primary:hover {
    background: #1d4ed8;
  }

  .btn-action.secondary {
    background: white;
    color: #2563eb;
    border: 2px solid #2563eb;
  }

  .btn-action.secondary:hover {
    background: #eff6ff;
  }

  .btn-action.warning {
    background: #f59e0b;
    color: white;
  }

  .btn-action.warning:hover {
    background: #d97706;
  }

  .decision-points {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 2rem;
  }

  .decision-item {
    display: flex;
    gap: 1rem;
  }

  .decision-item i {
    color: #10b981;
    font-size: 1.25rem;
    flex-shrink: 0;
  }

  .decision-item ul {
    margin: 0.5rem 0 0;
    padding-left: 1.5rem;
  }

  .warning-box {
    background: #fef2f2;
    border: 1px solid #fecaca;
    border-radius: 8px;
    padding: 1.5rem;
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .warning-box i {
    color: #ef4444;
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .decision-matrix {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
    margin-bottom: 3rem;
  }

  .decision-matrix h3 {
    margin: 0 0 2rem;
    text-align: center;
    font-size: 1.5rem;
  }

  .matrix-factors {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .factor-card {
    background: #f8fafc;
    padding: 1.5rem;
    border-radius: 8px;
  }

  .factor-card h4 {
    margin: 0 0 1rem;
    color: #1e293b;
    font-size: 1.125rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .factor-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .factor-card li {
    padding: 0.5rem 0;
    font-size: 0.875rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .factor-card li:last-child {
    border-bottom: none;
  }

  .factor-card .gold {
    color: #f59e0b;
    font-weight: 700;
  }

  .factor-card .silver {
    color: #6b7280;
    font-weight: 700;
  }

  .factor-card .bronze {
    color: #d97706;
    font-weight: 700;
  }

  .roi-calculator {
    background: #f8fafc;
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 3rem;
  }

  .roi-calculator h3 {
    margin: 0 0 2rem;
    text-align: center;
    font-size: 1.5rem;
  }

  .calculator-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: center;
  }

  .roi-inputs {
    display: grid;
    gap: 1.5rem;
  }

  .input-group label {
    display: block;
    font-size: 0.875rem;
    color: #64748b;
    margin-bottom: 0.5rem;
  }

  .input-group input,
  .input-group select {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 1rem;
    background: white;
  }

  .roi-results {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }

  .roi-metric {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    border-bottom: 1px solid #e5e7eb;
  }

  .roi-metric:last-child {
    border-bottom: none;
  }

  .roi-metric.highlight {
    background: #eff6ff;
    margin: 0 -2rem;
    padding: 1.5rem 2rem;
    border-radius: 8px;
    border: none;
  }

  .roi-metric .label {
    font-size: 0.875rem;
    color: #64748b;
  }

  .roi-metric .value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1e293b;
  }

  .roi-metric.highlight .value {
    color: #2563eb;
  }

  .next-steps {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
    color: white;
    border-radius: 16px;
    padding: 3rem;
    text-align: center;
  }

  .next-steps h3 {
    margin: 0 0 1rem;
    font-size: 2rem;
  }

  .steps-content p {
    font-size: 1.125rem;
    margin-bottom: 2rem;
    opacity: 0.9;
  }

  .steps-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .btn-action.large {
    padding: 1rem 2rem;
    font-size: 1rem;
  }

  .steps-actions .btn-action.secondary {
    background: white;
    color: #2563eb;
  }

  @media (max-width: 768px) {
    .tier-metrics {
      grid-template-columns: repeat(2, 1fr);
    }

    .calculator-content {
      grid-template-columns: 1fr;
    }

    .steps-actions {
      flex-direction: column;
    }
  }
</style>

<script>
  let assessmentData = null;
  let reportData = {
    id: 'EXEC-2025-001',
    title: 'Executive Security Assessment',
    organization: 'Contoso Corporation',
    date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
    riskScore: 78,
    complianceScore: 85,
    criticalFindings: 12,
    highFindings: 23,
    mediumFindings: 45,
    lowFindings: 67
  };

  // Initialize page
  document.addEventListener('DOMContentLoaded', async () => {
    // Load report data from localStorage or URL params
    const urlParams = new URLSearchParams(window.location.search);
    const reportId = urlParams.get('id') || 'EXEC-2025-001';
    const reportType = urlParams.get('type') || 'executive';
    const orgName = urlParams.get('org') || 'Contoso Corporation';
    
    // Try to load stored report data
    const storedReport = localStorage.getItem('currentReport');
    if (storedReport) {
      try {
        const parsed = JSON.parse(storedReport);
        reportData = {
          ...reportData,
          ...parsed,
          date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
        };
      } catch (e) {
        console.error('Failed to parse stored report:', e);
      }
    }
    
    // Update page with initial data
    updateReportDisplay();
    
    // Fetch real assessment data
    await loadAssessmentData(reportId, reportType, orgName);
    
    // Initialize charts
    initializeCharts();
  });
  
  async function loadAssessmentData(reportId, reportType, orgName) {
    try {
      // Show loading indicator
      showLoadingIndicator();
      
      // Fetch assessment data from API
      const response = await fetch(`/api/assessment-data?id=${reportId}&type=${reportType}&org=${orgName}`);
      if (!response.ok) {
        throw new Error('Failed to fetch assessment data');
      }
      
      assessmentData = await response.json();
      
      // Update report data with real values
      if (assessmentData.metrics) {
        reportData.riskScore = assessmentData.metrics.riskScore;
        reportData.complianceScore = assessmentData.metrics.complianceScore;
        reportData.criticalFindings = assessmentData.metrics.criticalFindings;
        reportData.highFindings = assessmentData.metrics.highFindings;
        reportData.mediumFindings = assessmentData.metrics.mediumFindings;
        reportData.lowFindings = assessmentData.metrics.lowFindings;
      }
      
      // Update display with real data
      updateReportDisplay();
      
      // Populate findings section
      if (assessmentData.findings) {
        populateFindings(assessmentData.findings);
      }
      
      // Populate evidence section
      if (assessmentData.evidence) {
        populateEvidence(assessmentData.evidence);
      }
      
      // Update charts with real data
      updateCharts();
      
    } catch (error) {
      console.error('Error loading assessment data:', error);
      showErrorMessage('Failed to load assessment data. Showing demo data instead.');
    } finally {
      hideLoadingIndicator();
    }
  }
  
  function updateReportDisplay() {
    document.getElementById('reportTitle').textContent = reportData.title;
    document.getElementById('orgName').textContent = reportData.organization || reportData.organizationName;
    document.getElementById('reportDate').textContent = `Generated: ${reportData.date}`;
    document.getElementById('reportId').textContent = reportData.id;
    document.getElementById('riskScore').textContent = `${reportData.riskScore}%`;
    document.getElementById('complianceScore').textContent = `${reportData.complianceScore}%`;
    
    // Update metric cards with real data
    const riskCard = document.querySelector('.metric-card.critical .metric-description');
    if (riskCard) {
      riskCard.textContent = `High risk due to ${reportData.criticalFindings} critical findings`;
    }
  }
  
  function populateFindings(findings) {
    const findingsList = document.querySelector('.findings-list');
    if (!findingsList) return;
    
    // Clear existing demo findings
    findingsList.innerHTML = '';
    
    // Add real findings
    findings.forEach(finding => {
      const findingCard = createFindingCard(finding);
      findingsList.appendChild(findingCard);
    });
    
    // Update finding counts in filters
    updateFindingCounts(findings);
  }
  
  function createFindingCard(finding) {
    const card = document.createElement('div');
    card.className = `finding-card ${finding.severity}`;
    card.setAttribute('data-severity', finding.severity);
    
    card.innerHTML = `
      <div class="finding-header">
        <div class="finding-title">
          <span class="severity-badge ${finding.severity}">${finding.severity.toUpperCase()}</span>
          <h3>${finding.title}</h3>
        </div>
        <div class="finding-meta">
          <span><i class="fas fa-server"></i> ${finding.service}</span>
          <span><i class="fas fa-tag"></i> ${finding.category}</span>
          <span><i class="fas fa-fingerprint"></i> ${finding.id}</span>
        </div>
      </div>
      
      <div class="finding-content">
        <div class="finding-description">
          <h4>Description</h4>
          <p>${finding.description}</p>
        </div>
        
        <div class="finding-evidence">
          <h4>Evidence</h4>
          <div class="evidence-box">
            <pre><code>${finding.evidence}</code></pre>
          </div>
          <button class="btn-link" onclick="viewFullEvidence('${finding.id}')">
            <i class="fas fa-external-link-alt"></i> View Full Evidence
          </button>
        </div>
        
        <div class="finding-impact">
          <h4>Business Impact</h4>
          <ul>
            ${finding.impact.map(i => `<li><i class="fas fa-exclamation-triangle"></i> ${i}</li>`).join('')}
          </ul>
        </div>
        
        <div class="finding-remediation">
          <h4>Remediation Steps</h4>
          <ol>
            ${finding.remediation.map((step, index) => `
              <li>
                ${step}
                ${index === 0 ? `<button class="btn-script" onclick="showScript('${finding.id}-remediate')">
                  <i class="fas fa-code"></i> PowerShell Script
                </button>` : ''}
              </li>
            `).join('')}
          </ol>
        </div>
        
        ${finding.references ? `
        <div class="finding-references">
          <h4>References & Resources</h4>
          <ul>
            ${finding.references.map(ref => `
              <li><a href="${ref}" target="_blank">
                <i class="fas fa-external-link-alt"></i> ${ref}
              </a></li>
            `).join('')}
          </ul>
        </div>` : ''}
      </div>
    `;
    
    return card;
  }
  
  function updateFindingCounts(findings) {
    const counts = {
      all: findings.length,
      critical: findings.filter(f => f.severity === 'critical').length,
      high: findings.filter(f => f.severity === 'high').length,
      medium: findings.filter(f => f.severity === 'medium').length,
      low: findings.filter(f => f.severity === 'low').length
    };
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
      const severity = btn.getAttribute('onclick').match(/filterFindings\('(\w+)'\)/)?.[1];
      if (severity && counts[severity] !== undefined) {
        btn.textContent = btn.textContent.replace(/\(\d+\)/, `(${counts[severity]})`);
      }
    });
  }
  
  function populateEvidence(evidence) {
    // PowerShell evidence
    const psList = document.querySelector('.evidence-card:nth-child(1) .evidence-list');
    if (psList) {
      psList.innerHTML = '';
      evidence.filter(e => e.type === 'powershell').forEach(item => {
        const div = document.createElement('div');
        div.className = 'evidence-item';
        div.innerHTML = `
          <span class="evidence-name">${item.name}</span>
          <span class="evidence-time">${new Date(item.timestamp).toLocaleString()}</span>
          <button class="btn-view" onclick="viewEvidence('${item.id}')">View Output</button>
        `;
        psList.appendChild(div);
      });
    }
    
    // Store evidence data for viewing
    window.evidenceData = evidence;
  }
  
  function updateCharts() {
    if (!assessmentData || !assessmentData.metrics) return;
    
    // Update risk distribution chart
    const riskChart = Chart.getChart('riskChart');
    if (riskChart) {
      riskChart.data.datasets[0].data = [
        assessmentData.metrics.criticalFindings,
        assessmentData.metrics.highFindings,
        assessmentData.metrics.mediumFindings,
        assessmentData.metrics.lowFindings
      ];
      riskChart.update();
    }
  }
  
  function showLoadingIndicator() {
    // Add loading overlay
    const overlay = document.createElement('div');
    overlay.id = 'loadingOverlay';
    overlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    `;
    overlay.innerHTML = `
      <div style="text-align: center;">
        <div style="font-size: 3rem; animation: spin 1s linear infinite;">⚡</div>
        <p style="margin-top: 1rem; font-size: 1.25rem; color: #6366f1;">Loading assessment data...</p>
      </div>
    `;
    document.body.appendChild(overlay);
  }
  
  function hideLoadingIndicator() {
    const overlay = document.getElementById('loadingOverlay');
    if (overlay) {
      overlay.remove();
    }
  }
  
  function showErrorMessage(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fee2e2;
      color: #dc2626;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      max-width: 400px;
    `;
    notification.innerHTML = `
      <div style="display: flex; align-items: center; gap: 0.5rem;">
        <span style="font-size: 1.25rem;">⚠️</span>
        <div>${message}</div>
      </div>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => notification.remove(), 5000);
  }

  // Navigation
  function showSection(sectionId) {
    // Hide all sections
    document.querySelectorAll('.report-section').forEach(section => {
      section.classList.remove('active');
    });
    
    // Remove active class from all tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Show selected section
    document.getElementById(sectionId).classList.add('active');
    
    // Set active tab
    event.target.classList.add('active');
  }

  // Initialize charts
  function initializeCharts() {
    const riskCtx = document.getElementById('riskChart');
    if (riskCtx) {
      new Chart(riskCtx, {
        type: 'doughnut',
        data: {
          labels: ['Critical', 'High', 'Medium', 'Low'],
          datasets: [{
            data: [12, 23, 45, 67],
            backgroundColor: ['#dc2626', '#f59e0b', '#facc15', '#10b981'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 15,
                font: { size: 14 }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.label + ': ' + context.parsed + ' findings';
                }
              }
            }
          }
        }
      });
    }
  }

  // Filter findings
  function filterFindings(severity) {
    const allFindings = document.querySelectorAll('.finding-card');
    const filterBtns = document.querySelectorAll('.filter-btn');
    
    // Update active button
    filterBtns.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Show/hide findings
    allFindings.forEach(finding => {
      if (severity === 'all' || finding.dataset.severity === severity) {
        finding.style.display = 'block';
      } else {
        finding.style.display = 'none';
      }
    });
  }

  // Action handlers
  function downloadReport(format) {
    console.log(`Downloading report in ${format} format`);
    // Implement download logic
  }

  function shareReport() {
    const shareUrl = window.location.href;
    navigator.clipboard.writeText(shareUrl);
    alert('Report link copied to clipboard!');
  }

  // Success Pathway Functions
  function downloadImplementationPlan(tier) {
    const plans = {
      gold: {
        name: 'Gold_Standard_Implementation_Plan.pdf',
        content: `Gold Standard Security Implementation Plan\n\nInvestment: $125,000 - $180,000\nTimeline: 6-9 months\nRisk Reduction: 95%\n\nPhase 1: Zero Trust Architecture (Months 1-2)\n- Implement Azure AD Conditional Access\n- Deploy Microsoft Intune for device management\n- Configure Privileged Identity Management (PIM)\n\nPhase 2: Advanced Threat Protection (Months 3-4)\n- Deploy Microsoft Sentinel\n- Configure automated incident response\n- Implement threat hunting capabilities\n\nPhase 3: Compliance & Governance (Months 5-6)\n- Implement Microsoft Purview\n- Configure data retention policies\n- Set up compliance reporting\n\nPhase 4: Monitoring & Optimization (Months 7-9)\n- Deploy 24/7 SOC monitoring\n- Implement security orchestration\n- Conduct penetration testing`
      },
      silver: {
        name: 'Silver_Balanced_Implementation_Plan.pdf',
        content: `Silver Balanced Security Implementation Plan\n\nInvestment: $60,000 - $90,000\nTimeline: 3-6 months\nRisk Reduction: 80%\n\nPhase 1: Core Security (Months 1-2)\n- Enable MFA for all users\n- Configure Conditional Access policies\n- Implement Microsoft Defender for Office 365\n\nPhase 2: Data Protection (Months 3-4)\n- Deploy Cloud App Security\n- Configure DLP policies\n- Set up automated compliance reporting\n\nPhase 3: Incident Response (Months 5-6)\n- Create incident response procedures\n- Train IT staff on security protocols\n- Implement monthly security reviews`
      },
      bronze: {
        name: 'Bronze_Essential_Implementation_Plan.pdf',
        content: `Bronze Essential Security Implementation Plan\n\nInvestment: $25,000 - $40,000\nTimeline: 1-3 months\nRisk Reduction: 60%\n\nMonth 1: Basic Protection\n- Enable MFA for all users\n- Configure security defaults\n- Set up basic conditional access\n\nMonth 2: Data Security\n- Implement basic DLP policies\n- Configure email protection\n- Set up audit logging\n\nMonth 3: Monitoring\n- Establish quarterly reviews\n- Create security documentation\n- Plan upgrade path to Silver tier`
      }
    };

    const plan = plans[tier];
    if (plan) {
      // Create blob and download
      const blob = new Blob([plan.content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = plan.name;
      a.click();
      URL.revokeObjectURL(url);
    }
  }

  function scheduleConsultation(tier = '') {
    const tierText = tier ? ` for ${tier.charAt(0).toUpperCase() + tier.slice(1)} tier` : '';
    alert(`Opening calendar to schedule consultation${tierText}. In production, this would integrate with your scheduling system.`);
    // In production, integrate with Calendly, Microsoft Bookings, etc.
  }

  function compareWithGold() {
    // Scroll to gold tier or show comparison modal
    document.querySelector('.gold-tier').scrollIntoView({ behavior: 'smooth' });
  }

  function showUpgradePath() {
    alert('Upgrade Path: Bronze → Silver → Gold\n\nWe recommend upgrading to Silver within 12 months to address security gaps. Contact us for a customized upgrade plan.');
  }

  function calculateROI(tier) {
    const breachCost = 280000;
    const breachProbability = 0.68;
    
    const tiers = {
      gold: { reduction: 0.95, cost: 150000 },
      silver: { reduction: 0.80, cost: 75000 },
      bronze: { reduction: 0.60, cost: 32500 }
    };
    
    const tierData = tiers[tier];
    const newProbability = breachProbability * (1 - tierData.reduction);
    const riskReduction = breachCost * (breachProbability - newProbability);
    const roi = ((riskReduction * 2 - tierData.cost) / tierData.cost * 100).toFixed(0);
    
    document.getElementById('roi-savings').textContent = '$' + riskReduction.toLocaleString();
    document.getElementById('roi-cost').textContent = '$' + tierData.cost.toLocaleString();
    document.getElementById('roi-percentage').textContent = roi + '%';
  }

  function requestProposal() {
    alert('Request submitted! Our team will prepare a detailed proposal within 24 hours.');
    // In production, send to CRM or email system
  }

  function downloadResource(resource) {
    const resources = {
      'mfa-checklist': {
        name: 'MFA_Implementation_Checklist.pdf',
        content: 'MFA Implementation Checklist\n\n1. Inventory all user accounts\n2. Enable MFA in Azure AD\n3. Configure authentication methods\n4. Create conditional access policies\n5. Pilot with IT team\n6. Roll out to departments\n7. Monitor adoption rates\n8. Address user issues\n9. Document procedures\n10. Schedule regular reviews'
      }
    };
    
    const res = resources[resource];
    if (res) {
      const blob = new Blob([res.content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = res.name;
      a.click();
      URL.revokeObjectURL(url);
    }
  }

  function viewEvidence(id) {
    // Find evidence data
    const evidence = window.evidenceData?.find(e => e.id === id);
    if (!evidence) {
      console.error('Evidence not found:', id);
      return;
    }
    
    // Create modal to show evidence
    const modal = document.createElement('div');
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      padding: 2rem;
    `;
    
    modal.innerHTML = `
      <div style="background: white; border-radius: 12px; max-width: 1200px; width: 100%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
        <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; font-size: 1.25rem; color: #1e293b;">
            <i class="fas fa-terminal"></i> ${evidence.name}
          </h3>
          <button onclick="this.closest('.fixed').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #9ca3af;">&times;</button>
        </div>
        <div style="flex: 1; overflow-y: auto; padding: 1.5rem;">
          <div style="font-size: 0.875rem; color: #64748b; margin-bottom: 1rem;">
            Executed: ${new Date(evidence.timestamp).toLocaleString()}
          </div>
          <div style="background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.875rem; overflow-x: auto;">
            <pre style="margin: 0; white-space: pre-wrap;">${evidence.content || 'No output available'}</pre>
          </div>
        </div>
        <div style="padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; display: flex; gap: 1rem; justify-content: flex-end;">
          <button onclick="navigator.clipboard.writeText(this.getAttribute('data-content')); alert('Copied to clipboard!')" 
                  data-content="${(evidence.content || '').replace(/"/g, '&quot;')}"
                  style="background: #eff6ff; border: 1px solid #3b82f6; color: #3b82f6; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
            <i class="fas fa-copy"></i> Copy Output
          </button>
          <button onclick="this.closest('.fixed').remove()" style="background: #6366f1; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
            Close
          </button>
        </div>
      </div>
    `;
    
    // Add click outside to close
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.remove();
      }
    });
    
    document.body.appendChild(modal);
  }

  function viewScreenshot(id) {
    console.log(`Viewing screenshot ${id}`);
    // Implement screenshot viewer
  }

  function downloadEvidence(id) {
    console.log(`Downloading evidence ${id}`);
    // Implement evidence download
  }

  async function showScript(scriptId) {
    try {
      // Fetch remediation script
      const response = await fetch(`/api/remediation-script?id=${scriptId}`);
      if (!response.ok) throw new Error('Failed to fetch script');
      
      const scriptData = await response.json();
      
      // Create modal to show script
      const modal = document.createElement('div');
      modal.className = 'fixed';
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 2rem;
      `;
      
      modal.innerHTML = `
        <div style="background: white; border-radius: 12px; max-width: 1200px; width: 100%; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
          <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.25rem; color: #1e293b;">
              <i class="fas fa-code"></i> ${scriptData.title}
            </h3>
            <p style="margin: 0; color: #64748b; font-size: 0.95rem;">${scriptData.description}</p>
            ${scriptData.requirements ? `
              <div style="margin-top: 1rem; padding: 1rem; background: #fef3c7; border-radius: 6px;">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 0.875rem; color: #92400e;">Requirements:</h4>
                <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.875rem; color: #78350f;">
                  ${scriptData.requirements.map(req => `<li>${req}</li>`).join('')}
                </ul>
              </div>
            ` : ''}
          </div>
          <div style="flex: 1; overflow-y: auto; padding: 1.5rem;">
            <div style="background: #1e293b; color: #e2e8f0; padding: 1.5rem; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.875rem; overflow-x: auto;">
              <pre style="margin: 0; white-space: pre-wrap;">${scriptData.script}</pre>
            </div>
          </div>
          <div style="padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; display: flex; gap: 1rem; justify-content: space-between;">
            <div style="display: flex; gap: 1rem;">
              <button onclick="navigator.clipboard.writeText(this.getAttribute('data-script')); alert('Script copied to clipboard!')" 
                      data-script="${scriptData.script.replace(/"/g, '&quot;').replace(/\</g, '&lt;').replace(/\>/g, '&gt;')}"
                      style="background: #eff6ff; border: 1px solid #3b82f6; color: #3b82f6; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-copy"></i> Copy Script
              </button>
              <button onclick="downloadScript('${scriptData.id}', '${scriptData.title}')" 
                      style="background: #f0fdf4; border: 1px solid #10b981; color: #10b981; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-download"></i> Download .ps1
              </button>
            </div>
            <button onclick="this.closest('.fixed').remove()" style="background: #6366f1; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer;">
              Close
            </button>
          </div>
        </div>
      `;
      
      // Store script data for download
      window.currentScript = scriptData;
      
      // Add click outside to close
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
      
      document.body.appendChild(modal);
      
    } catch (error) {
      console.error('Error loading script:', error);
      alert('Failed to load remediation script');
    }
  }
  
  function downloadScript(scriptId, title) {
    const script = window.currentScript;
    if (!script) return;
    
    const blob = new Blob([script.script], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${title.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.ps1`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function showGuide(guideId) {
    console.log(`Showing guide ${guideId}`);
    // Implement guide viewer
  }

  function showTemplate(templateId) {
    console.log(`Showing template ${templateId}`);
    // Implement template viewer
  }

  function showImplementationPlan(planId) {
    console.log(`Showing implementation plan ${planId}`);
    // Implement plan viewer
  }

  function calculateROI(itemId) {
    console.log(`Calculating ROI for ${itemId}`);
    // Implement ROI calculator
  }

  function viewFullEvidence(findingId) {
    console.log(`Viewing full evidence for ${findingId}`);
    // Implement full evidence viewer
  }

  function downloadResource(resourceId) {
    console.log(`Downloading resource ${resourceId}`);
    // Implement resource download
  }
</script>